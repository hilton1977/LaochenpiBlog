---
layout: post
title: JVM 基础概念
categories: [Jvm]
comments: true
date: 2019-03-21 21:01:28
tags:
	- Java
	- 技术
---

>JVM 复习基本概念学习和记录

## 概述
对于 Java 程序员来说，在虚拟机自动内存管理机制下，不再需要像C/C++程序开发程序员这样为内一个 new 操作去写对应的 delete/free 操作，不容易出现内存泄漏和内存溢出问题。正是因为 Java 程序员把内存控制权利交给 Java 虚拟机，一旦出现内存泄漏和溢出方面的问题，如果不了解虚拟机是怎样使用内存的，那么排查错误将会是一个非常艰巨的任务。

## JVM 运行时候数据区域
Java 虚拟机在执行 java 程序的过程中会把管理的内存划分为若干个不同的数据区域，JDK 1.8 和之前的版本有不同。
![JDK 1.8之前内存划分](/images/JVM-1.8-before.png)
![JDK 1.8版本的内存划分](/images/JVM-1.8-after.png)

##### 线程私有的：
- 程序计数器
- 虚拟机栈
- 本地方法栈

##### 线程共享的：
- 堆
- 方法区
- 直接内存（非运行数据区的一部分） 

### 程序计数器
程序计数器（`Pargram Counter Register`）是一块很小的内存空间，可以看作是当前线程所执行的字节码的行号指示器。 字节码解释器工作通过改变计数器的值来选择下一条需要执行的字节码指令，分支、循环、跳转、异常处理、线程恢复等基础功能都依赖此计数器。多线程中每个线程都有一个计数器用来记录线程执行的位置，每个计数器之间相互不影响独立，独立存储，被称为“线程私有”的内存。

__程序计数器是唯一一个不会出现`OutOfMemoryError`的内存区域，它的生命周期随着线程的创建才创建，结束而结束。__

### 虚拟机栈
 Java 虚拟机栈（`Jasva Virtual Machine Stacks`）也是私有内存，它的生命周期和线程一样，描述的是 Java 方法执行的内存模型： 每个方法在执行的同时都会创建一个帧栈（`Stack Frame`）用于存储局部变量表、操作数栈、动态链接、方法出口等信息。每个方法的执行完成的过程对应着每个帧栈在虚拟栈中入栈到出栈的过程。

 __局部变量表__的主要存放了编译期可知的各种__基本数据类型__（`boolean`、`byte`、`char`、`short`、`int`、`float`、`long`、`double`）、对象引用（`reference`类型，不同于对象本身，可能是一个指向对象起始地址的引用指针，也可能是指向一个代表对象的句柄或其他与此对象相关的位置）